---
title: Azure 标准负载均衡器和可用性区域
titleSuffix: Azure Load Balancer
description: 了解此学习途径后，开始 Azure 标准负载均衡器和可用性区域。
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/07/2020
ms.author: allensu
ms.openlocfilehash: 6deb5714a43d61f5ceb793757d49bd099f09f2b7
ms.sourcegitcommit: 999ccaf74347605e32505cbcfd6121163560a4ae
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/08/2020
ms.locfileid: "82977630"
---
# <a name="standard-load-balancer-and-availability-zones"></a>标准负载均衡器和可用性区域

Azure 标准负载均衡器支持可用性区域方案。 你可以使用标准负载均衡器，通过在区域之间对齐资源和分发来提高方案的可用性。 可用性区域与标准负载均衡器结合使用，是一种广泛而灵活的功能集，可以创建多种不同的方案。  请查看本文档了解这些[概念](#concepts)和基本场景的[设计指南](#design)。

## <a name="availability-zones-concepts-applied-to-load-balancer"></a><a name="concepts"></a> 适用于负载均衡器的可用性区域概念

负载均衡器从其组件继承区域配置： 

* 前端
* 规则
* 后端池定义

在可用性区域的上下文中，负载均衡器规则的行为和属性被描述为区域冗余或区域。  在负载均衡器的上下文中，区域冗余始终表示**多个区域**，而区域是指将服务隔离到一个**区域**。 Azure 负载均衡器有两种类型：公共和内部。 这两种类型的负载均衡器都支持区域冗余和区部署。  这两种负载均衡器类型都可以根据需要将流量定向到各个区域。

## <a name="frontend"></a>前端

负载均衡器前端是用于引用虚拟网络子网中的公共 IP 地址或专用 IP 地址的前端 IP 配置。 它构成了公开服务的负载均衡终结点。

负载均衡器资源可以同时包含带有区域和区域冗余前端的规则。 当向某个区域保证公用或专用 IP 时，局域性不会更改,。 若要更改或省略公用或专用 IP 地址前端的局域性，请在相应的区域中重新创建 IP。 

可用性区域不会更改多个前端的约束。 有关此功能的详细信息，请查看[负载均衡器的多个前端](load-balancer-multivip-overview.md)。

### <a name="zone-redundant"></a>区域冗余 

在具有可用性区域的区域中，标准负载均衡器前端可以是区域冗余的。 多个区域可以在某个区域中提供入站或出站服务。 此流量由单个 IP 地址提供服务。 不需要 DNS 冗余方案。 

单个前端 IP 地址将在区域发生故障后仍然存在。 前端 IP 可用于访问所有（不受影响）的后端池成员，这与区域无关。 一个或多个可用性区域可能会失败，并且数据路径置，只要区域中的一个区域仍处于正常状态。 

前端的 IP 地址由多个可用性区域中的多个独立基础结构部署同时提供服务。 任何重试或重新建立都将在不受区域故障影响的其他区域成功完成。 

:::image type="content" source="./media/az-zonal/zone-redundant-lb-1.svg" alt-text="区域冗余" border="true":::

*图：区域冗余负载均衡器*

### <a name="zonal"></a>剖面

可以选择将某个前端指定为保证位于单个区域，这称为局域性前端。**  这种情况意味着，任何入站或出站流都由区域中的单个区域提供服务。  前端的运行状态取决于该局部区域。  区域（保证前端所在的区域除外）中发生故障不会影响数据路径。 可以使用局域性前端来按可用性区域公开 IP 地址。  

此外，还支持在每个区域中直接对负载平衡终结点使用区域前端。 可以使用此配置来公开每个区域负载均衡的终结点，以单独监视每个区域。 对于公用终结点，你可以将它们与[流量管理器](../traffic-manager/traffic-manager-overview.md)等 dns 负载平衡产品集成，并使用单个 DNS 名称。

:::image type="content" source="./media/az-zonal/zonal-lb-1.svg" alt-text="区域冗余" border="true":::

如果想要混合使用这些概念（对同一个后端使用区域冗余和局域性配置），请查看 [Azure 负载均衡器的多个前端](load-balancer-multivip-overview.md)。

对于公共负载均衡器前端，请将**区域**参数添加到公共 IP。 此公共 IP 由各自规则使用的前端 IP 配置引用。

对于内部负载均衡器前端，请将**区域**参数添加到内部负载均衡器的前端 IP 配置。 区域性前端保证子网中的 IP 地址指向特定区域。

## <a name="backend"></a>后端

Azure 负载均衡器适用于虚拟机实例。 这些实例可以是独立的、可用性集或虚拟机规模集。 单个虚拟网络中的任何虚拟机都可以是后端池的一部分，即虚拟机保证的任何区域。

要使前端和后端与单个区域保持一致，只需要将同一区域中的虚拟机放入相应的后端池。

若要跨多个区域处理虚拟机，请将多个区域中的虚拟机放入同一后端池。 

使用虚拟机规模集时，请将一个或多个虚拟机规模集置于相同的后端池中。 规模集可以位于单个或多个区域中。

## <a name="outbound-connections"></a>出站连接

区域冗余和区域性适用于[出站连接](load-balancer-outbound-connections.md)。 用于出站连接的区域冗余公共 IP 地址由所有区域提供。 区域性公共 IP 地址仅由其保证的区域提供服务。 

发生区域故障时，出站连接 SNAT 端口分配将继续提供出站 SNAT 连接（如果不受区域故障的影响）。 如果通信由受影响的区域提供，则区域故障可能需要为区域冗余方案重新建立连接。 不受影响的区域之外的区域中的流不会受到影响。

SNAT 端口预先分配算法与或没有可用性区域相同。

## <a name="health-probes"></a>运行状况探测

现有的运行状况探测定义保持不变，因为它们没有可用性区域。 但是，我们在基础结构级别展开了运行状况模型。 

使用区域冗余的前端时，负载均衡器会扩展其内部运行状况检查。 负载均衡器从每个区域单独探测虚拟机的可用性，并跨区域关闭路径，而无需干预。  

可以访问此 VM 的其他区域可继续从其各自的前端为此 VM 提供服务。 在发生故障时，每个区域都可能会有不同的新流分布，同时保护服务的总体运行状况。

## <a name="design-considerations"></a><a name="design"></a>设计注意事项

负载均衡器在可用性区域的上下文中是灵活的。 您可以选择为每个规则调整区域或区域冗余。 提高可用性的代价是增加了复杂性。 设计可用性以获得最佳性能。

### <a name="automatic-zone-redundancy"></a>自动区域冗余

使用负载均衡器可以轻松地将一个 IP 用作区域冗余的前端。 区域冗余 IP 地址可以为任何区域中的区域性资源提供服务。  只要一个区域在该区域中保持正常，则 IP 可能会经受一个或多个区域故障。  相反，区域性前端将服务缩减为单个区域，并与各自的区域共享命运。

区域冗余并不意味着意味着数据路径或控制平面;它是数据平面。 区域冗余流可以使用任何局部区域，客户流使用区域中所有正常的局部区域。 在区域发生故障时，使用健康区域的流量不受影响。 

区域发生故障时使用区域的流量可能会受到影响，但应用程序可以恢复。 当 Azure 围绕区域发生故障时，重新传输时，流量将在区域内的正常区域中继续进行。

### <a name="cross-zone-boundaries"></a><a name="xzonedesign"></a>跨区域边界

请务必了解，无论何时服务跨区域，你都可以共享命运而不是一个区域，但可能会有多个区域。 因此，你的服务可能未在非区域性部署上获得任何可用性。

避免引入不需要的跨区域依赖项，这将在使用可用性区域时废除可用性提升。 如果你的应用程序包含多个关键组件，请确保在区域发生故障时的生存。

应用程序的单个关键组件可能会影响整个应用程序，前提是该应用程序仅存在于另一个区域，而不是保留的区域。 考虑区域还原以及应用程序的聚合方式。 了解应用程序如何应对其部分故障。 查看关键点，并将其用于在你想通过特定方案时遇到的问题。

- 如果你的应用程序具有两个组件：

    * IP 地址
    * 包含托管磁盘的虚拟机

它们是在区域1和区域2中配置的。 当区域1发生故障时，你的服务将无法继续。 不要跨区域使用区域性方案，除非你完全了解你要创建潜在的危险故障模式。 此方案允许提供灵活性。

- 如果你的应用程序具有两个组件：

    * IP 地址
    * 包含托管磁盘的虚拟机

它们配置为区域冗余和区域1。 如果区域1发生故障，你的服务将在区域2和区域3的区域故障后仍然存在。 但是，如果你所观察到的所有功能都是前端的可访问性，则会失去对服务运行状况的一些原因。  请考虑开发一个涵盖范围更广泛的运行状况和容量模型。  可以结合使用区域冗余和局域性的概念来拓宽见解和可管理性。

- 如果你的应用程序具有两个组件：

    * 区域冗余负载均衡器前端
    * 三个区域中的跨区域虚拟机规模集

不受故障影响的区域中的资源将可用。 在发生故障时，服务容量可能会下降。 从基础结构的角度来看，部署可能会经受一个或多个区域故障。 此方案将引发以下问题：

  - 你是否了解应用程序如何响应故障和降级的容量？
  - 是否需要在服务中采取防护措施，以便在必要时强制故障转移到某个区域对？
  - 如何监视、检测和缓解此类场景？ 可以使用标准负载均衡器诊断来增强服务性能的监视。 请考虑有哪些可用以及需要增加哪些内容。

- 使用区域可以更轻松地识别和遏制故障。 发生超时、重试和回退算法时，区域故障与其他故障没有什么不同。 Azure 负载均衡器提供区域冗余路径。 负载均衡器会在数据包级别实时尝试快速恢复。 开始发生故障时，可能会发生重传或 reestablishments。 了解应用程序副本故障的方式很重要。 你的负载平衡方案将保留下来，但你需要规划以下问题：

  - 当区域发生故障时，你的服务是否能识别此故障，如果状态丢失，你会如何恢复？
  - 当区域恢复正常时，应用程序是否知道如何安全聚合？

查看[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。

## <a name="next-steps"></a>后续步骤
- 详细了解[可用性区域](../availability-zones/az-overview.md)
- 详细了解[标准负载均衡器](load-balancer-standard-overview.md)
- 了解如何[使用具有区域性前端的标准负载均衡器在区域内对 VM 进行负载均衡](load-balancer-standard-public-zonal-cli.md)
- 了解如何[使用具有区域冗余前端的标准负载均衡器跨区域对 VM 进行负载均衡](load-balancer-standard-public-zone-redundant-cli.md)
- 了解[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。
