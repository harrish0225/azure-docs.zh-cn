---
title: Azure 安全中心的合作伙伴漏洞扫描程序
description: Azure 安全中心支持集成第三方漏洞评估解决方案。 本文介绍如何设置这些工具。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/13/2019
ms.author: memildin
ms.openlocfilehash: ac68e5a91f72954ce54892f22ab5ba3a7a593bbf
ms.sourcegitcommit: 50ef5c2798da04cf746181fbfa3253fca366feaa
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/30/2020
ms.locfileid: "82611426"
---
# <a name="deploying-a-partner-vulnerability-scanning-solution"></a>部署合作伙伴漏洞扫描解决方案

如果你使用的是标准层，则可以使用 Azure 安全中心的内置漏洞评估工具，如[虚拟机的集成漏洞扫描程序](built-in-vulnerability-assessment.md)中所述。 此工具不需要 Qualys 许可证，甚至不需要 Qualys 帐户-所有内容都在安全中心内无缝处理。

或者，你可能想要从[Qualys](https://www.qualys.com/lp/azure)或[Rapid7](https://www.rapid7.com/products/insightvm/)部署你自己的私有许可漏洞评估解决方案。 可以在属于同一订阅的多个 Vm 上安装其中一个合作伙伴解决方案。

## <a name="configuring-a-partner-solution-in-the-azure-portal"></a>配置合作伙伴解决方案（在 Azure 门户中）

1. 在“安全中心”仪表板的“概览”部分，单击“建议”************。

1. 在 "**建议**" 页上，选择 "**应在虚拟机上安装漏洞评估解决方案**"。

    ![漏洞评估](./media/security-center-vulnerability-assessment-recommendations/security-center-vulnerability-assessment-fig1-new.png)

1. 在 "**应在虚拟机上安装漏洞评估解决方案**" 页上，选择要在其中安装漏洞评估解决方案的 vm。

    ![添加漏洞评估解决方案](./media/security-center-vulnerability-assessment-recommendations/security-center-vulnerability-assessment-fig2-new.png)

1. 在 "**应在虚拟机上安装漏洞评估解决方案**" 页面上，单击 "**在2个 vm 上安装**" （此名称可能因所选 vm 数目而异）：

    ![添加漏洞评估](./media/security-center-vulnerability-assessment-recommendations/security-center-vulnerability-assessment-fig3-new.png)

1. 可以创建新的漏洞评估，也可以使用现有的解决方案。 如果创建新的漏洞评估，可以在“Azure 市场”中选择合作伙伴解决方案。**** 也可以在“使用现有解决方案”下选择“Qualys”或“Rapid7”。************

    若要从安全中心部署代理，需要供应商提供的许可证代码和公钥。 若要了解如何获取许可证代码和公钥，请参阅 [Qualys 文档](https://community.qualys.com/docs/DOC-5823-deploying-qualys-cloud-agents-from-microsoft-azure-security-center)或 [Rapid7 文档](https://insightvm.help.rapid7.com/docs/azure-security-center)。


1. 若要创建新评估，请单击 "**新建**"。 此时会打开合作伙伴的 "**漏洞管理**" 页。 此页上显示的选项可能会因合作伙伴而异。

    ![创建新的漏洞评估解决方案](./media/security-center-vulnerability-assessment-recommendations/security-center-vulnerability-assessment-fig4-new.png)

    若要设置 Qualys （例如），请选择 " **Qualys** "，然后执行以下操作：
    
    1. 对于“资源组”，请选择“使用现有资源组”。********
    
    1. 对于“位置”，请选择解决方案所在的地理位置。****
    
    1. 在“许可证代码”**** 框（特定于 Qualys）中，输入合作伙伴提供的许可证。
    
    1. 在“公钥”框（特定于 Qualys）中，输入合作伙伴提供的公钥信息。****
    
    1. 若要在此 Qualys 解决方案的订阅中的所有已发现 Vm 上自动安装漏洞评估代理，请选中 "**自动更新**" 复选框。
    
    1. 单击“确定”。 


## <a name="configuring-a-partner-solution-using-powershell-and-the-rest-api"></a>配置合作伙伴解决方案（使用 PowerShell 和 REST API）

若要以编程方式从[Qualys](https://www.qualys.com/lp/azure)或[Rapid7](https://www.rapid7.com/products/insightvm/)部署你自己的私有许可漏洞评估解决方案，请使用提供的脚本[PowerShell > 漏洞解决方案](https://github.com/Azure/Azure-Security-Center/tree/master/Powershell%20scripts/Vulnerability%20Solution)。 

此脚本使用 REST API 在 ASC 中创建新的安全解决方案。 解决方案需要服务提供商提供的许可证和密钥： Qualys 或 Rapid7。

> [!IMPORTANT] 
> 每个许可证只能创建一个解决方案。 尝试使用同一名称/许可证/密钥创建另一个解决方案将会失败。

### <a name="prerequisites"></a>先决条件

所需的 PowerShell 模块：

- 安装模块 Az
- 安装模块 Az. security

### <a name="running-the-script"></a>运行脚本

若要运行该脚本，需要以下参数的相关信息。

| **参数** | **必需** | **说明** |
|----|:----:|----|
|**订阅**|✔|包含要分析的资源的 Azure 订阅的 subscriptionID。|
|**ResourceGroupName**|✔|资源组的名称。 使用任何现有的资源组，包括默认的（"DefaultResourceGroup-xxx"）。 由于解决方案不是 Azure 资源，因此它不会列在资源组中，但仍附加到该资源组。|
|**vaSolutionName**|✔|新解决方案的名称。|
|**vaType**|✔|Qualys 或 Rapid7。|
|**licenceCode**|✔|供应商提供的许可字符串。|
|**publicKey**|✔|供应商提供的公钥。|
|**更新**|-|为此 VA 解决方案启用（true）或禁用（false）自动部署。 启用后，订阅中的每个新 VM 将自动尝试链接到该解决方案。<br/>（默认值：False）|


语法：

```
.\New-ASCVASolution.ps1 -subscriptionId <Subscription Id> -resourceGroupName <RG Name>
-vaSolutionName <New solution name> -vaType <Qualys / Rapid7> -autoUpdate <true/false>
-licenceCode <License code from vendor> -publicKey <Public Key received from vendor>
```

示例（此示例不包含有效的许可证详细信息）：

```
.\New-ASCVASolution.ps1 -subscriptionId 'f4cx1b69-dtgb-4ch6-6y6f-ea2e95373d3b' -resourceGroupName 'DefaultResourceGroup-WEU' -vaSolutionName 'QualysVa001' -vaType 'Qualys' -autoUpdate 'false' `
-licenceCode 'eyJjaWQiOiJkZDg5OTYzXe4iMTMzLWM4NTAtODM5FD2mZWM1N2Q3ZGU5MjgiLCJgbTYuOiIyMmM5NDg3MS1lNTVkLTQ1OGItYjhlMC03OTRhMmM3YWM1ZGQiLCJwd3NVcmwiOiJodHRwczovL3FhZ3B1YmxpYy1wMDEuaW50LnF1YWx5cy5jb20vQ2xvdSKJY6VudC8iLCJwd3NQb3J0IjoiNDQzIn0=' `
-publicKey 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOiOLXjOywMfLZIBGPZLwSocf1Q64GASLK9OHFEmanBl1nkJhZDrZ4YD5lM98fThYbAx1Rde2iYV1ze/wDlX4cIvFAyXuN7HbdkeIlBl6vWXEBZpUU17bOdJOUGolzEzNBhtxi/elEZLghq9Chmah82me/okGMIhJJsCiTtglVQIDAQAB'
```


## <a name="review-the-recommendation"></a>查看建议
在目标 VM 上安装漏洞评估解决方案后，安全中心会扫描 VM，检测并识别系统和应用程序中的漏洞。

> [!NOTE]
> 完成第一次扫描可能需要数小时。 此后的每次扫描需要一小时。

检测到的问题显示在 "**虚拟机建议**" 下。

## <a name="next-steps"></a>后续步骤

本文介绍了由 Qualys 提供支持的内置漏洞评估工具，用于扫描 Vm。 有关相关材料，请参阅以下文章：

- [了解建议的不同元素](security-center-recommendations.md)
- [了解如何修正建议](security-center-remediate-recommendations.md)